# RealCtrl 项目发布指南

本指南详细说明了如何将 RealCtrl 项目从开发状态打包为可供最终用户使用的桌面应用程序。

## 1. 编译器选择

**推荐版本：Visual Studio 2022 社区版 (Community Edition)**

- **成本效益**：完全免费，功能强大。
- **兼容性**：完美支持 MFC，并能平滑升级旧的 VC6 项目。
- **性能**：现代编译器优化能显著提升程序运行效率和稳定性。

## 2. 发布步骤

### 第一步：环境准备与项目升级

1.  **安装 Visual Studio 2022**：
    -   在安装时，务必勾选工作负载 **“使用 C++ 的桌面开发”**。
    -   在右侧的“安装详细信息”中，确保勾选了 **“适用于最新 v143 生成工具的 C++ MFC (x86 和 x64)”**。

2.  **升级项目**：
    -   使用 Visual Studio 2022 打开项目根目录下的 `RealCtrl.dsw` 文件。
    -   VS 会提示你进行“单向升级”。点击“确定”，它会自动将所有 `.dsp` 文件转换为 `.vcxproj` 格式，并生成一个现代的 `.sln` 解决方案文件。

### 第二步：配置为 Release 模式

在 Visual Studio 顶部的工具栏中，将解决方案配置从 `Debug` 切换为 **`Release`**。

- **原因**：
    - `Debug` 版本包含大量的调试信息和符号，文件体积大，运行效率低。
    - `Release` 版本会进行代码优化，移除调试信息，生成体积小、运行速度快的可执行文件。

### 第三步：配置 MFC 静态链接（关键）

为了让你的软件能在没有安装 Visual Studio 的普通用户电脑上直接运行，你需要将 MFC 库静态链接到你的程序中。

1.  在“解决方案资源管理器”中，右键点击 `RealCtrl` 主项目，选择 **“属性”**。
2.  确保顶部的“配置”为 **“活动(Release)”**，“平台”为 **“活动(Win32)”**。
3.  导航到 **“配置属性” -> “高级”**，将 **“字符集”** 设置为 **“使用多字节字符集”**。（旧项目通常使用多字节字符集，这一步能避免很多编译错误）。
4.  导航到 **“配置属性” -> “常规”**，找到 **“MFC 的使用”**，将其设置为 **“在静态库中使用 MFC”**。
5.  导航到 **“C/C++” -> “代码生成”**，找到 **“运行库”**，将其设置为 **“多线程 (/MT)”**。
6.  **对所有 DLL 项目重复此操作**：对 `Element`、`PsADCtrl`、`DcsPrtcl` 这三个项目也执行步骤 3、4、5。

### 第四步：编译生成

1.  在菜单栏选择 **“生成” -> “清理解决方案”**，以清除旧的编译文件。
2.  然后选择 **“生成” -> “重新生成解决方案”**。

编译成功后，你会在项目根目录下的 `Release` 文件夹里找到 `RealCtrl.exe` 以及相关的 DLL 文件。

### 第五步：打包与分发

1.  **创建发布文件夹**：
    -   新建一个文件夹，例如 `RealCtrl_v1.0_Release`。
    -   将 `Release` 文件夹中的 `RealCtrl.exe` 拷贝进去。
    -   如果第三步中你没有对所有项目都成功设置为静态链接，那么还需要将 `Release` 文件夹中的 `Element.dll`、`PsADCtrl.dll`、`DcsPrtcl.dll` 也拷贝进去。

2.  **创建安装包 (可选但推荐)**：
    为了提供更专业的用户体验，建议使用安装包制作工具。
    -   **Inno Setup**：免费、功能强大且有大量的脚本示例，非常适合此类项目。你可以编写一个简单的脚本，将发布文件夹中的所有文件打包成一个 `setup.exe` 安装程序，并可以指定安装路径、创建桌面快捷方式等。
    -   **NSIS (Nullsoft Scriptable Install System)**：另一个优秀的免费选择，同样通过脚本来定义安装流程。

## 3. 重要提醒：修复硬件接口

在执行以上所有步骤之前，**必须**先解决 `DataAquisit.cpp` 中的 `_inp` 和 `_outp` 函数调用问题。正如 `HARDWARE_INTERFACE_FIX_PLAN.md` 中所述，这些函数在现代 Windows 系统上会直接导致程序崩溃。

**在发布前，你必须将它们替换为模拟实现或空实现**，否则发布出去的软件将无法在任何标准电脑上运行。
